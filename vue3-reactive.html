<body>

</body>
<script>

  const obj = {
    ok: true,
    text: 'text'
  }
  
  let bucket = new WeakMap()
  let activeEffect = null
  const proxy = new Proxy(obj, {
    get(target, propKey, receiver) {
      track(target, propKey);
      return target[propKey]
    },
    set(target, key, value, receiver) {
      target[key] = value
      trigger(target, key)
    }
  })

  const track = (target, propKey) => {
    let depMap = bucket.get(target)
    if(!depMap){
      bucket.set(target, depMap = new Map())
    }
    let deps = depMap.get(propKey);
    if(!deps) depMap.set(propKey, deps = new Set());
    activeEffect && deps.add(activeEffect)
  }

  const trigger = (target, key) => {
    const depsMap = bucket.get(target)
    if(!depsMap) return
    const effects = depsMap.get(key);
    effects?.forEach(effect => {
      effect()
    })
  }

  function effect(fn) {
    activeEffect = fn
    fn()

  }

  const fn = () => {
    document.body.innerHTML = obj.ok ? obj.text : 'not'
  }

  effect(fn)

  proxy.ok = false

  setTimeout(() => {

  }, 1000);

</script>